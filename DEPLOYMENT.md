# Deployment Guide - Stocking One Planner

This guide will help you deploy your NestJS application to Render with a free PostgreSQL database from Neon.

## Prerequisites

- GitHub account
- Render account (free tier)
- Neon account (free tier) or Supabase account

---

## Step 1: Set Up Free PostgreSQL Database

### Option A: Neon (Recommended)

1. Go to [Neon](https://neon.tech/) and sign up for free
2. Create a new project
3. Copy the connection string - it will look like:
   ```
   postgresql://username:password@ep-xxxxx.us-east-2.aws.neon.tech/neondb?sslmode=require
   ```
4. Save this connection string - you'll need it later

**Free Tier Limits:**
- 1 project
- 3 GB storage
- Unlimited compute hours with scale-to-zero

### Option B: Supabase

1. Go to [Supabase](https://supabase.com/) and sign up for free
2. Create a new project
3. Go to Settings â†’ Database
4. Copy the "Connection string" (URI format)
5. Replace `[YOUR-PASSWORD]` with your actual database password

**Free Tier Limits:**
- 2 projects
- 500 MB database storage
- Unlimited API requests

---

## Step 2: Push Code to GitHub

1. Initialize git repository (if not already done):
   ```bash
   git init
   git add .
   git commit -m "Initial commit - ready for deployment"
   ```

2. Create a new repository on GitHub

3. Push your code:
   ```bash
   git remote add origin https://github.com/YOUR_USERNAME/YOUR_REPO.git
   git branch -M main
   git push -u origin main
   ```

---

## Step 3: Deploy to Render

### Using render.yaml (Recommended)

1. Go to [Render Dashboard](https://dashboard.render.com/)
2. Click "New +" â†’ "Blueprint"
3. Connect your GitHub repository
4. Render will automatically detect the `render.yaml` file
5. Set the environment variables:
   - `DATABASE_URL`: Paste your Neon/Supabase connection string
   - `JWT_SECRET`: Will be auto-generated by Render
6. Click "Apply" to deploy

### Manual Setup (Alternative)

1. Go to Render Dashboard
2. Click "New +" â†’ "Web Service"
3. Connect your GitHub repository
4. Configure:
   - **Name**: stocking-one-planner
   - **Runtime**: Node
   - **Build Command**: `npm install && npm run build`
   - **Start Command**: `npm run start:prod`
   - **Plan**: Free
5. Add Environment Variables:
   - `NODE_ENV` = `production`
   - `DATABASE_URL` = Your Neon/Supabase connection string
   - `JWT_SECRET` = Generate with: `openssl rand -base64 32`
6. Click "Create Web Service"

---

## Step 4: Verify Deployment

1. Wait for the build to complete (3-5 minutes)
2. Render will provide you with a URL like: `https://stocking-one-planner.onrender.com`
3. Visit the URL - you should see the login page
4. Log in with:
   - **Username**: `admin`
   - **Password**: `gowalmart`

The admin user is automatically created on first startup by the `DatabaseInitService`.

---

## Important Notes

### Free Tier Limitations

**Render Free Tier:**
- Web service spins down after 15 minutes of inactivity
- First request after inactivity takes ~30 seconds to wake up
- 750 hours/month of runtime (sufficient for 1 service)

**Neon Free Tier:**
- Database scales to zero when not in use
- 3 GB storage limit
- Cold start delay: ~1-2 seconds

### Database Persistence

Your PostgreSQL database on Neon/Supabase is **persistent** - data will never be deleted unless you manually delete it. This is a major improvement over the SQLite setup, which would lose data on Render's free tier.

### Security Considerations

1. **Never commit .env files** - they're already in `.gitignore`
2. **Use strong JWT_SECRET** in production
3. **Change admin password** - Currently hardcoded to "gowalmart". To change:
   - Delete the existing admin user from the database
   - Update `src/auth/database-init.service.ts` with new credentials
   - Redeploy

### Monitoring

- View logs in Render Dashboard â†’ Your Service â†’ Logs
- Monitor database usage in Neon/Supabase dashboard

---

## Troubleshooting

### Build Fails

- Check that all dependencies are in `package.json`
- Verify Node version compatibility (app uses Node 18+)
- Check build logs in Render dashboard

### Database Connection Errors

- Verify `DATABASE_URL` is set correctly in Render environment variables
- Ensure connection string includes `?sslmode=require` for Neon
- Check that Neon/Supabase project is active

### App Won't Start

- Check start command is: `npm run start:prod`
- Verify build command completed successfully
- Check that `dist/main.js` was created during build

### Login Not Working

- Check browser console for errors
- Verify JWT_SECRET is set in environment variables
- Clear browser localStorage/sessionStorage and try again

---

## Local Development with PostgreSQL

If you want to test with PostgreSQL locally:

1. Install PostgreSQL locally
2. Create a local database:
   ```bash
   createdb stocking_one_planner
   ```
3. Copy `.env.example` to `.env`:
   ```bash
   cp .env.example .env
   ```
4. Update `.env` with your local database URL:
   ```
   DATABASE_URL=postgresql://username:password@localhost:5432/stocking_one_planner
   JWT_SECRET=your-local-secret-key
   NODE_ENV=development
   ```
5. Run the app:
   ```bash
   npm run start:dev
   ```

---

## Updating Your Deployment

When you make changes to your code:

1. Commit and push to GitHub:
   ```bash
   git add .
   git commit -m "Your commit message"
   git push
   ```

2. Render will automatically detect the push and redeploy (if auto-deploy is enabled)

---

## Cost Summary

- **Neon Database**: Free (3 GB storage, scales to zero)
- **Render Web Service**: Free (with 15-min sleep)
- **Total Monthly Cost**: $0.00

Enjoy your free deployment! ðŸš€
